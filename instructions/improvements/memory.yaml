memories:
  - id: pr-approval-checker-1
    timestamp: '2025-12-16T00:00:00Z'
    type: lesson
    context: Building pr-approval-checker CLI tool
    observation: |
      Used raw `setTimeout` wrapped in Promise for polling delays instead of the
      existing `port-ephemeral-scheduler` package. User correctly identified that
      we should use the proper abstraction.
    lesson: |
      Always use `port-ephemeral-scheduler.delay()` for delays instead of raw setTimeout.
      The scheduler provides lifecycle management (dispose cancels pending), injectable
      dependencies for testing, and consistent patterns across the codebase.
    evidence:
      - file: apps/pr-approval-checker/src/checker.ts
        pattern: scheduler.delay wrapped in Promise for async delay
      - file: apps/pr-approval-checker/src/composition.ts
        pattern: createEphemeralScheduler with injected timers
    tags:
      - scheduler
      - testing
      - contract-port

  - id: pr-approval-checker-2
    timestamp: '2025-12-16T00:00:00Z'
    type: pattern
    context: CLI tool architecture using contract-port pattern
    observation: |
      Successfully built a production CLI tool following contract-port architecture
      with composition root, dependency injection, and proper error hierarchy.
    lesson: |
      For new CLI tools in apps/, follow this structure:
      - cli.ts: thin entry point, arg parsing with commander
      - composition.ts: composition root, inject all platform globals
      - types.ts: shared type definitions
      - errors.ts: error classes extending ConveauxError
      - [domain].ts: core business logic with injected deps
    evidence:
      - file: apps/pr-approval-checker/src/composition.ts
        pattern: createRuntimeDeps factory with injectable deps
      - file: apps/pr-approval-checker/src/errors.ts
        pattern: UserError and RetryableError subclasses
    tags:
      - cli
      - architecture
      - contract-port
